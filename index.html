<!DOCTYPE HTML><html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Ivaylo's Surveillance Camera</title>
</head>
<body>
<div id="container">
   <h1>WebSocket Camera Feed</h1>
   <div id="button-container">
    <button onclick="capturePhoto()" class="capture_email_button">CAPTURE PHOTO</button>
    <button onclick="location.reload()" class="Refresh_button" type="button">
        <svg viewBox="0 0 16 16" class="bi bi-arrow-repeat" fill="currentColor" height="16" width="16" xmlns="http://www.w3.org/2000/svg">
        <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"></path>
        <path d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z" fill-rule="evenodd"></path>
      </svg>
          REFRESH
      </button>
      
    <button onclick="emailPhoto();" class="capture_email_button">EMAIL PHOTO</button>

    <label class="switch">
        <input class="chk_85" type="checkbox" id="flashlightSwitch" onchange="toggleFlashlightSwitch(this)">
        <span class="slider">
          <svg viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" class="torch">
          <path d="M 63.85,54.65 Q 62.77,54.13 61.88,53.31 Q 54.13,46.12 46.31,37.69 Q 43.88,35.06 44.29,31.53 Q 44.51,29.56 46.54,25.87 Q 56.15,8.39 59.06,3.56 Q 60.59,1.03 63.83,2.41 Q 67.73,4.07 71.11,6.55 Q 72.85,7.82 77.51,11.86 Q 89.11,21.92 96.94,34.06 Q 100.09,38.95 95.24,41.73 Q 83.77,48.31 72.16,54.64 Q 68.24,56.77 63.85,54.65 Z" fill="#ffffff"></path>
          <path d="M 14.03,66.29 Q 27.40,51.66 40.57,37.33 A 0.54,0.54 52.1 0 1 41.44,37.44 Q 43.25,40.72 45.58,43.04 Q 47.66,45.11 47.71,45.17 Q 54.67,52.58 62.60,58.93 A 0.44,0.43 43.0 0 1 62.63,59.59 Q 42.87,77.87 22.77,95.78 Q 20.75,97.58 19.20,97.93 Q 16.72,98.49 14.81,96.94 Q 6.88,90.47 2.81,84.94 Q 1.47,83.11 2.03,80.84 Q 2.37,79.43 4.04,77.51 Q 8.97,71.84 14.03,66.29 ZM 42.9269,57.1766 A 3.76 3.76 0.0 0 0 37.6102,57.0930 L 33.1721,61.3938 A 3.76 3.76 0.0 0 0 33.0886,66.7106 L 33.3531,66.9834 A 3.76 3.76 0.0 0 0 38.6698,67.0670 L 43.1079,62.7662 A 3.76 3.76 0.0 0 0 43.1914,57.4494 L 42.9269,57.1766 Z" fill="#ffffff"></path>
          </svg>
          <svg class="b" width="100%" height="50%" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M29 20L31 22" class="bling_85"></path>
          <path d="M31.5 15H34.5" class="bling_85"></path>
          <path d="M29 10L31 8" class="bling_85"></path>
          </svg>
        </span>
      </label>
   </div>
  <div id="live-container">
  <img id="live" src="">
  </div>
</div>
</body>
<script>
var gateway = `ws://${window.location.hostname}/ws`;
var socket;

                if (!('WebSocket' in window)) {
                    alert('Your browser does not support web sockets');
                } else {
                    setupWebSocket();
                }

                function setupWebSocket() {
                    var host = 'ws://' + window.location.hostname + ':81';
                    socket = new WebSocket(host);
                    socket.binaryType = 'arraybuffer';

                    if (socket) {
                        socket.onopen = function () {
                            console.log('WebSocket connection opened');
                        }

                        socket.onmessage = function (msg) {
                            var bytes = new Uint8Array(msg.data);
                            var binary = '';
                            var len = bytes.byteLength;

                            for (var i = 0; i < len; i++) {
                                binary += String.fromCharCode(bytes[i]);
                            }

                            var img = document.getElementById('live');
                            img.src = 'data:image/jpg;base64,' + window.btoa(binary);
                        }

                        socket.onclose = function () {
                            console.log('WebSocket connection closed');
                        }
                    }
                }
                function toggleFlashlightSwitch(switchElement) {
            if (socket && socket.readyState == WebSocket.OPEN) {
                const action = switchElement.checked ? "turnOnFlashlight" : "turnOffFlashlight";
                socket.send(action);
            }
        }
        function capturePhoto() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                // Display the response message on the webpage
                alert(xhr.responseText);

                // Check the photo capture status
                checkPhotoStatus();
            }
        };
        xhr.open("GET", "/capture", true);
        xhr.send();
    }

    function checkPhotoStatus() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                // Check the photo capture status
                var status = xhr.responseText;
                if (status === "success") {
                    // Display success message or perform other actions
                    alert("Photo capture and save successful!");
                } else {
                    // Display failure message or handle accordingly
                    alert("Photo capture and save failed.");
                }
            }
        };
        xhr.open("GET", "/photo-status", true);
        xhr.send();
    }
  function emailPhoto() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', "/email-photo", true);
    xhr.send();
  }
</script>
</body>
</html>